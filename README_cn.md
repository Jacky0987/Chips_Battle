
## 股票交易模拟程序技术文档

# 一、引言
本技术文档详细描述了股票交易模拟程序的架构、设计和实现细节。该程序旨在模拟股票市场的交易环境，包括用户操作、股票交易逻辑、市场状态更新等功能。

# 二、程序架构

## 1. 模块结构
程序主要由以下几个模块组成：
- `market.py`：负责市场的相关操作，如股票的添加、移除、价格更新和信息打印。
- `menu.py`：包含游戏菜单和认证菜单的逻辑，处理用户的输入选择和相应的操作。
- `stock.py`：定义了股票类，包含股票的属性和价格更新、价格历史记录、图表绘制等方法。
- `user.py`：实现用户类，涵盖用户的基本信息、股票交易操作、持仓查看、交易历史展示以及数据保存等功能。

## 2. 数据存储与交互
- 用户数据：使用 JSON 格式存储在文件中，通过 `User` 类的 `save_userdata` 方法进行保存和读取。
- 股票数据：在程序运行期间存储在内存中的相关类对象中。

# 三、模块详解

## 1. `Market` 模块（`market.py`）
- `__init__` 方法：初始化市场对象，创建股票列表和设置默认的世界环境值。
    - `self.stocks`：用于存储市场中的股票对象。
    - `self.world_environment`：表示影响股票价格的世界环境因素。
- `add_stock` 方法：将新的股票添加到市场中，确保股票不存在于市场时才添加，并打印相应的提示信息。
- `remove_stock` 方法：从市场中移除指定的股票，只有当股票存在于市场时执行移除操作，并打印提示。
- `update_all_stocks` 方法：遍历市场中的所有股票，调用每个股票的价格更新方法。
- `print_all_stocks` 方法：打印市场中所有股票的详细信息，包括世界环境值、股票的各种属性。

## 2. `Menu` 模块（`menu.py`）
- `options` 字典：定义了用户在菜单中可选择的操作选项及其描述。
- `game_menu` 函数：游戏主菜单逻辑。
    - 启动一个线程 `update_prices` 用于实时更新股票价格。
    - 循环等待用户输入选择，并根据选择执行相应的操作，如买卖股票、查看持仓、市场信息等。
    - 在操作后检查用户现金是否低于零，若低于零则退出模拟。
- `auth_menu` 函数：认证菜单逻辑。
    - 提供注册、登录和退出的选项。
    - 根据用户输入执行相应的认证操作，并进行提示和递归调用以保持菜单的可用性。

## 3. `Stock` 模块（`stock.py`）
- `__init__` 方法：初始化股票对象的属性，包括代码、名称、初始价格、初始发行股数等，并初始化价格历史记录。
    - `self.code`：股票代码。
    - `self.name`：股票名称。
    - `self.initial_price`：初始价格。
    - `self.current_price`：当前价格。
    - `self.initial_issued_shares`：初始发行股数。
    - `self.purchasable_shares`：可购买股数。
    - `self.trading_volume`：交易总量。
    - `self.price_history`：价格历史记录。
    - `self.historical_mean`：历史平均价格。
    - `self.volatility`：波动率。
- `update_price` 方法：更新股票的当前价格，并将时间戳和新价格添加到价格历史记录中。
- `draw_price_history` 方法：使用 `matplotlib.pyplot` 库绘制股票价格历史的折线图，并添加百分比变化、初始价格等标注。
- `update_rw_price` 方法：根据世界环境、交易volume等因素计算并更新股票的随机游走价格。
- `get_current_price` 方法：返回股票的当前价格。
- `get_price_history` 方法：返回股票的价格历史记录。

## 4. `User` 模块（`user.py`）
- `__init__` 方法：初始化用户对象的属性，包括用户名、现金、股票持仓和交易记录。
    - `self.name`：用户名。
    - `self.cash`：现金余额。
    - `self.stocks`：股票持仓字典，键为股票代码，值为持有数量。
    - `self.trades`：交易记录列表。
- `buy_market_price_stock` 方法：用户购买股票的操作，包含对股票有效性、购买数量、资金充足性等的检查，成功购买后更新用户现金、股票持仓和交易记录。
- `sell_market_price_stock` 方法：用户卖出股票的操作，检查持仓数量是否足够，成功卖出后更新相关数据。
- `view_holdings` 方法：打印用户当前的股票持仓和现金余额。
- `show_history` 方法：打印用户的交易历史记录。
- `to_dict` 方法：将用户对象的相关数据转换为字典格式，以便进行 JSON 序列化。
- `save_userdata` 方法：将用户数据以 JSON 格式保存到指定文件中。
- `get_current_cash` 方法：返回用户当前的现金余额。
- `add_cash` 方法：增加用户的现金余额。
- `deduce_cash` 方法：扣除用户的现金余额。

# 四、技术实现要点

### 1. 随机价格更新
股票价格的更新采用了随机游走模型，并考虑了世界环境、历史均值和交易 volume 等因素的影响，以模拟真实市场中的价格波动。

### 2. 并发处理
在 `game_menu` 中，使用线程来实时更新股票价格，以模拟市场的动态变化，同时不阻塞用户的操作输入和处理。

### 3. 数据序列化
用户数据使用 JSON 进行序列化和保存，以便在程序多次运行之间保持用户的状态和交易记录。

# 五、运行环境
- Python 版本：3.11
- 依赖库：`matplotlib`、`numpy`、`datetime`、`json`

# 六、未来改进方向
- 增加更多的市场影响因素和交易策略。
- 优化价格更新算法，提高模拟的真实性。
- 提供更丰富的用户交互和界面展示。

